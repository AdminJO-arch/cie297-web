<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CIE-297 | Monitoreo en Tiempo Real</title>
<link rel="icon" href="assets/logo.png"/>
<link rel="preconnect" href="https://unpkg.com"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root{
  --bg:#0b1424;--card:#101b31;--soft:#12213b;--text:#e5ecff;--muted:#93a4c7;
  --ok:#22c55e;--warn:#f59e0b;--danger:#ef4444;--line:rgba(255,255,255,.08);
  --pill:#1b2a45;--chip:#0f1b30;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;font:14px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:var(--bg)}
a{color:#8ab4ff;text-decoration:none}
.container{max-width:1200px;margin:0 auto;padding:16px}
.appbar{display:flex;gap:.75rem;justify-content:space-between;padding:.75rem 1rem;background:#0b1424;position:sticky;top:0;z-index:30;border-bottom:1px solid var(--line)}
.brand{display:flex;gap:.5rem;align-items:center;font-weight:800;font-size:18px}
.brand img{height:28px;width:28px;object-fit:contain;border-radius:4px}
.actions{display:flex;gap:.5rem;align-items:center}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
.card h3{margin:0 0 8px}
.row{display:grid;gap:14px}
@media (min-width:1000px){.row{grid-template-columns:2fr 1fr}}
.badge{display:inline-block;padding:.375rem .6rem;border-radius:999px;border:1px solid var(--line);background:var(--chip);color:var(--muted);font-weight:600}
.btn{padding:.6rem 1rem;border-radius:10px;background:#193257;border:1px solid var(--line);color:#e5ecff;cursor:pointer}
.btn:hover{filter:brightness(1.06)}
.btn-danger{background:#182334;border-color:#ef6b6b;color:#ff9aa9}
.input,.select,.textarea{width:100%;background:#0f1b30;border:1px solid var(--line);border-radius:10px;padding:.55rem .6rem;color:#e5ecff}
.textarea{min-height:120px;resize:vertical}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.small{font-size:12px;color:var(--muted)}
.right{margin-left:auto}
.hidden{display:none !important}
.hr{height:1px;background:var(--line);margin:14px 0}

/* Alert chips de nivel */
.level{display:inline-flex;align-items:center;gap:.4rem;padding:.35rem .65rem;border-radius:999px;border:1px solid rgba(255,255,255,.12);font-weight:700;letter-spacing:.5px}
.level[data-lvl="ALTA"]{background:#39161a;color:#ff6b6b;border-color:#ff6b6b}
.level[data-lvl="MEDIA"]{background:#2a2815;color:#ffd34d;border-color:#ffd34d}
.level[data-lvl="BAJA"]{background:#0d2a1a;color:#7df59a;border-color:#22c55e}

/* Órganos/indicativos lista */
.unit{background:#0f1b2b;border:1px solid var(--line);border-radius:12px;padding:12px;margin-bottom:10px}
.unit-title{font-weight:800;font-size:15px}
.unit-sub{font-size:12px;color:#9fb1d7;margin-top:4px}
.unit-right{float:right;color:#9fb1d7}

/* Tabla admin */
.table{width:100%;border-collapse:separate;border-spacing:0}
.table th,.table td{padding:.55rem .6rem;border-bottom:1px solid var(--line)}
.table thead th{background:#0d1a2f;color:#9fb1d7;border-bottom:1px solid rgba(255,255,255,.2)}
.table tbody tr:hover{background:#0e1d34}

/* Login modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:50}
.modal .dialog{width:100%;max-width:560px;background:#0f1b2b;border:1px solid var(--line);border-radius:12px;padding:16px}
.modal .dialog h3{margin:0 0 10px}
</style>
</head>
<body>

<header class="appbar">
  <div class="brand">
    <img src="assets/logo.png" alt="logo" onerror="this.style.display='none'">
    <div>CIE-297 | Monitoreo en Tiempo Real</div>
  </div>
  <div class="actions">
    <button id="btnAdminSwitch" class="btn hidden">Panel admin</button>
    <button id="btnLogout" class="btn hidden">Cerrar sesión</button>
  </div>
</header>

<div class="container">

  <!-- ACCESO -->
  <div id="viewAccess" class="card">
    <h3>Acceso</h3>
    <div class="small">Primero crea una cuenta o pulsa “Iniciar sesión”. El sistema se mostrará después.</div>
    <div class="grid2" style="margin-top:10px">
      <div>
        <h4>Registro</h4>
        <div class="grid2">
          <select id="rgGrado" class="select">
            <option value="" hidden>Grado</option>
            <option>GRAL</option><option>CNL</option><option>TCNL</option>
            <option>MY</option><option>CAP</option><option>TTE</option><option>SBTTE</option>
          </select>
          <input id="rgEsp" class="input" placeholder="Especialidad"/>
        </div>
        <div class="grid2" style="margin-top:8px">
          <input id="rgNom" class="input" placeholder="Nombres"/>
          <input id="rgApe" class="input" placeholder="Apellidos"/>
        </div>
        <input id="rgEmail" class="input" placeholder="Email" style="margin-top:8px"/>
        <input id="rgPass" type="password" class="input" placeholder="Contraseña" style="margin-top:8px"/>
        <button id="btnRegister" class="btn" style="margin-top:10px">Crear cuenta</button>
      </div>
      <div>
        <h4>Iniciar sesión</h4>
        <button id="openLogin" class="btn">Iniciar sesión</button>
      </div>
    </div>
  </div>

  <!-- APP (usuario/admin) -->
  <div id="viewApp" class="hidden">
    <div class="row">
      <div class="card">
        <h3>Área Operativa</h3>
        <div id="map" style="height:340px;border:1px dashed rgba(255,255,255,.15);border-radius:12px"></div>
        <div style="margin-top:10px">Leyenda:
          <span class="level" data-lvl="BAJA">BAJA</span>
          <span class="level" data-lvl="MEDIA">MEDIA</span>
          <span class="level" data-lvl="ALTA">ALTA</span>
        </div>
      </div>
      <div class="card">
        <h3>Órganos de búsqueda</h3>
        <div class="small" id="unitsCount">0 activos</div>
        <div id="unitsList" style="margin-top:10px"></div>
      </div>
    </div>

    <div class="row" style="margin-top:14px">
      <div class="card">
        <h3>Misiones / Reportes rápidos</h3>
        <div class="grid2">
          <div>
            <label class="small">Tipo</label>
            <select id="rpTipo" class="select">
              <option>Rebasado</option>
              <option>Cambio de locación</option>
              <option>Secuestro</option>
              <option>Lleno de operativos</option>
              <option>Incautación de autos</option>
              <option>Observación</option>
              <option>Otros</option>
            </select>
          </div>
          <div>
            <label class="small">Nivel</label>
            <select id="rpNivel" class="select">
              <option>BAJA</option><option>MEDIA</option><option>ALTA</option>
            </select>
          </div>
        </div>

        <div class="grid2" style="margin-top:8px">
          <div>
            <label class="small">Código indicativo del lugar</label>
            <select id="selLugar" class="select">
              <option>HAWAI</option><option>CUBA</option><option>BEIRUT</option><option>LOMAS</option>
            </select>
          </div>
          <div>
            <label class="small">Código indicativo de canales</label>
            <select id="selCanal" class="select">
              <option>BLANCO</option><option>ROJO</option><option>AZUL</option><option>AMARILLO</option>
              <option>VERDE</option><option>ROSADO</option><option>GUINDO</option><option>CARMESI</option>
              <option>NEGRO</option><option>KAKI</option><option>MARRON</option><option>TURQUESA</option>
              <option>CELESTE</option><option>NARANJA</option><option>PURPURA</option><option>GRIS</option>
            </select>
          </div>
        </div>

        <div style="margin-top:8px">
          <label class="small">Mensaje (indicativos preestablecidos)</label>
          <select id="rpMensaje" class="select">
            <option>PETA</option><option>LAMBO</option><option>TRICICLO</option><option>PATINETA</option>
            <option>FRUTAS</option><option>MOTOBOMBA</option><option>CUCHARA</option><option>TENEDOR</option>
            <option>CHISGUETE</option><option>PINTURA ROJA</option><option>PINTURA NARANJA</option>
            <option>PINTURA AZUL</option><option>PINTURA VERDE</option><option>PINTURA AMARILLA</option>
            <option>PINTURA CAFE</option><option>YENAS</option><option>LOBOS</option><option>LIEBRES</option>
            <option>JUGANDO</option><option>RIO PILCOMAYO</option><option>LAGUNA ESCOBAR</option><option>MALLASA</option>
            <option>CIELO NUBLADO</option><option>HOTEL RADISSON</option><option>HERRADURA</option><option>FEDERAL</option>
            <option>CAIMAN</option><option>LAGARTOS</option>
          </select>
        </div>

        <div class="grid2" style="margin-top:8px">
          <div>
            <label class="small">Ubicación</label>
            <div class="grid2">
              <input id="rpLat" class="input" placeholder="lat"/>
              <input id="rpLng" class="input" placeholder="lng"/>
            </div>
          </div>
          <div>
            <label class="small">&nbsp;</label>
            <button id="btnUbic" class="btn">Usar ubicación</button>
          </div>
        </div>

        <div style="margin-top:8px">
          <label class="small">Descripción</label>
          <textarea id="rpDesc" class="textarea" placeholder="Detallar lo ocurrido..."></textarea>
        </div>

        <div class="hr"></div>
        <div class="actions">
          <button id="btnSend" class="btn">Enviar</button>
          <div class="right"></div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;align-items:center;gap:10px">
          <h3 style="margin:0">Alertas</h3>
          <span id="alertCount" class="badge">0</span>
        </div>
        <div id="alertList" style="margin-top:10px;max-height:420px;overflow:auto"></div>
      </div>
    </div>

    <!-- PANEL ADMIN -->
    <div id="adminBlock" class="hidden" style="margin-top:14px">
      <div class="row">
        <div class="card">
          <div style="display:flex;gap:10px;align-items:center">
            <h3 style="margin:0">Alertas (10 más recientes)</h3>
            <button id="btnExportPdf" class="btn right">Exportar PDF</button>
          </div>
          <table class="table" id="tblTop10" style="margin-top:8px">
            <thead><tr>
              <th>ID</th><th>Fecha y hora</th><th>Nivel</th><th>Título</th><th>Agente</th><th>Ubicación</th>
            </tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="card">
          <div style="display:flex;gap:10px;align-items:center">
            <h3 style="margin:0">Bitácora de búsqueda</h3>
          </div>
          <table class="table" id="tblBitacora" style="margin-top:8px">
            <thead><tr><th>Fecha y hora</th><th>Usuario</th><th>Lugar</th><th>Canal</th><th>Llamadas</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="row" style="margin-top:14px">
        <div class="card">
          <div style="display:flex;gap:10px;align-items:center">
            <h3 style="margin:0">Accesos</h3>
          </div>
          <table class="table" id="tblAccesos" style="margin-top:8px">
            <thead><tr><th>Fecha y hora</th><th>Email</th><th>Grado</th><th>Especialidad</th><th>Estado</th><th>Acción</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="card">
          <h3>Ver todas las alertas (por día)</h3>
          <div id="allByDay" class="small"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de login -->
<div id="loginModal" class="modal hidden">
  <div class="dialog">
    <h3>Iniciar sesión</h3>
    <div class="grid2">
      <input id="lgEmail" class="input" placeholder="Email"/>
      <input id="lgPass" type="password" class="input" placeholder="Contraseña"/>
    </div>
    <div class="actions" style="margin-top:10px">
      <button id="btnDoLogin" class="btn">Entrar</button>
      <button id="btnCloseLogin" class="btn right">Cerrar</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
const ADMIN = {email:'admin@cie297.mil', pass:'Admin123!'};
const STORAGE = { USERS:'cie_u', ACCESS:'cie_access', BLOCK:'cie_block', ALERTS:'cie_alerts', BITAC:'cie_bitac' };
const INDICATIVOS_LLAMADAS = ['ZEUS','ARIES','VIRGO','SAGITARIO','LIBRA','CAPRICORNIO','GEMINIS','ESCORPIO','TAURO','CANCER','LEO','PISCIS'];
const GRUPOS = ['ALFA','BRAVO','CHARLIE','DELTA'];
const ESTADOS = ['EN MISIÓN','EN ESPERA','SIN SEÑAL'];
const $=s=>document.querySelector(s); const $$=s=>document.querySelectorAll(s);
const nowStr=()=>new Date().toISOString().replace('T',' ').slice(0,19);
const uid=()=>Math.random().toString(16).slice(2,7);
const read=k=>JSON.parse(localStorage.getItem(k)||'[]');
const write=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
let currentUser=null,isAdmin=false;

/* Login */
$('#openLogin').onclick=()=>$('#loginModal').classList.remove('hidden');
$('#btnCloseLogin').onclick=()=>$('#loginModal').classList.add('hidden');

$('#btnRegister').onclick=()=>{
  const u={grado:$('#rgGrado').value,esp:$('#rgEsp').value,nom:$('#rgNom').value,ape:$('#rgApe').value,email:$('#rgEmail').value.trim(),pass:$('#rgPass').value};
  if(!u.email||!u.pass){alert('Completa email y contraseña');return;}
  const users=read(STORAGE.USERS); if(users.find(x=>x.email===u.email)){alert('Ya existe un usuario con ese email');return;}
  users.push(u); write(STORAGE.USERS,users); alert('Cuenta creada. Pulsa Iniciar sesión.');
};
function blocked(email){return new Set(read(STORAGE.BLOCK)).has(email);}
$('#btnDoLogin').onclick=()=>{
  const email=$('#lgEmail').value.trim(), pass=$('#lgPass').value;
  if(blocked(email)){alert('Acceso bloqueado');return;}
  if(email===ADMIN.email && pass===ADMIN.pass){ currentUser={email,grado:'TCNL',esp:'Administrador',nom:'Administrador',ape:'CIE-297'}; isAdmin=true; afterLogin(); return;}
  const u=read(STORAGE.USERS).find(x=>x.email===email && x.pass===pass);
  if(!u){alert('Credenciales no válidas');return;}
  currentUser=u; isAdmin=false; afterLogin();
};

/* Post login */
let map, markerMe=null;
function afterLogin(){
  $('#loginModal').classList.add('hidden');
  $('#viewAccess').classList.add('hidden');
  $('#viewApp').classList.remove('hidden');
  $('#btnLogout').classList.remove('hidden');
  $('#btnAdminSwitch').classList.toggle('hidden',!isAdmin);
  // registrar acceso
  const acc=read(STORAGE.ACCESS); acc.unshift({ts:nowStr(), email:currentUser.email, grado:currentUser.grado||'-', esp:currentUser.esp||'-'}); write(STORAGE.ACCESS,acc);
  initMap(); renderUnits(); renderAlerts(); startSim();
  if(isAdmin){ $('#adminBlock').classList.remove('hidden'); renderAdminTables(); }
}
$('#btnLogout').onclick=()=>location.reload();

/* Mapa */
function initMap(){
  map=L.map('map',{zoomControl:true}).setView([-16.29,-63.58],5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap'}).addTo(map);
}
$('#btnUbic').onclick=()=>{
  if(!navigator.geolocation){alert('Sin geoloc.');return;}
  navigator.geolocation.getCurrentPosition(p=>{
    $('#rpLat').value=p.coords.latitude.toFixed(6);
    $('#rpLng').value=p.coords.longitude.toFixed(6);
    if(map){ if(markerMe) map.removeLayer(markerMe); markerMe=L.marker([p.coords.latitude,p.coords.longitude]).addTo(map); map.setView([p.coords.latitude,p.coords.longitude],12); }
  },_=>alert('No se pudo obtener ubicación'));
};

/* Órganos (indicativos) */
function renderUnits(){
  const list=$('#unitsList'); list.innerHTML='';
  const count=12; const now=new Date();
  for(let i=0;i<count;i++){
    const name=INDICATIVOS_LLAMADAS[i];
    const g=GRUPOS[i%GRUPOS.length];
    const st=ESTADOS[i%ESTADOS.length];
    const lat=(-14 + Math.random()*(-22+14)).toFixed(4);
    const lng=(-63 + Math.random()*(-69+63)).toFixed(4);
    const row=document.createElement('div'); row.className='unit';
    row.innerHTML=\`
      <div class="unit-right small">\${st}</div>
      <div class="unit-title">\${name}</div>
      <div class="unit-sub">\${g} • Fix \${now.toISOString().replace('T',' ').slice(0,19)} • \${lat}, \${lng}</div>\`;
    list.appendChild(row);
  }
  $('#unitsCount').textContent=\`\${count} activos\`;
}

/* Alertas */
function loadAlerts(){return read(STORAGE.ALERTS);}
function saveAlerts(a){write(STORAGE.ALERTS,a);}
function pushAlert(obj){const a=loadAlerts(); a.unshift(obj); saveAlerts(a);}

function renderAlerts(){
  const cont=$('#alertList'); const a=loadAlerts(); $('#alertCount').textContent=a.length;
  cont.innerHTML='';
  a.slice(0,100).forEach(x=>{
    const div=document.createElement('div'); div.className='unit';
    div.innerHTML=\`
      <div style="display:flex;gap:8px;align-items:center">
        <span class="level" data-lvl="\${x.nivel}">\${x.nivel}</span>
        <span class="small">\${x.ts}</span>
      </div>
      <div style="margin-top:6px;font-weight:800">\${x.agente} • \${x.titulo}</div>
      <div class="small">\${x.lat&&x.lng?(\`(\${x.lat}, \${x.lng})\`):''}</div>\`;
    cont.appendChild(div);
  });
}

/* Simulación cada 5s */
let simTimer=null;
function startSim(){
  clearInterval(simTimer);
  simTimer=setInterval(()=>{
    const lvl=['BAJA','MEDIA','ALTA'][Math.floor(Math.random()*3)];
    const agente=INDICATIVOS_LLAMADAS[Math.floor(Math.random()*INDICATIVOS_LLAMADAS.length)];
    const titles=['Interferencia RF','Geocerca violada','Movimiento anómalo','Pérdida de comunicación','Actualización de posición','Incidente'];
    const titulo=titles[Math.floor(Math.random()*titles.length)];
    const lat=( -18 + Math.random()*4 ).toFixed(4);
    const lng=( -66 + Math.random()*4 ).toFixed(4);
    const item={id:uid(), ts:nowStr(), nivel:lvl, titulo, agente, lat, lng};
    pushAlert(item);
    renderAlerts();
    if(isAdmin) fillTop10();
  },5000);
}

/* Envío de reporte */
$('#btnSend').onclick=()=>{
  const item={
    id:uid(), ts:nowStr(), nivel:$('#rpNivel').value,
    titulo: \`\${$('#rpTipo').value} — \${$('#rpMensaje').value}\`,
    agente: INDICATIVOS_LLAMADAS[Math.floor(Math.random()*INDICATIVOS_LLAMADAS.length)],
    lat: $('#rpLat').value, lng: $('#rpLng').value, desc: $('#rpDesc').value
  };
  pushAlert(item); renderAlerts(); if(isAdmin) fillTop10();
  alert('Reporte registrado');
};

/* Bitácora de búsqueda (cambios de selects) */
['selLugar','selCanal'].forEach(id=>{
  $('#'+id).onchange=()=>{
    const b=read(STORAGE.BITAC);
    b.unshift({ts:nowStr(), user:currentUser?currentUser.email:'-', lugar:$('#selLugar').value, canal:$('#selCanal').value, llam:'-'});
    write(STORAGE.BITAC,b); if(isAdmin) fillBitac();
  };
});

/* Admin */
function renderAdminTables(){ fillTop10(); fillBitac(); fillAccesos(); fillByDay(); }
function fillTop10(){
  const tb=$('#tblTop10 tbody'); tb.innerHTML='';
  loadAlerts().slice(0,10).forEach(x=>{
    const tr=document.createElement('tr');
    tr.innerHTML=\`<td>\${x.id}</td><td>\${x.ts}</td><td>\${x.nivel}</td><td>\${x.titulo}</td><td>\${x.agente}</td><td>\${x.lat||''}, \${x.lng||''}</td>\`;
    tb.appendChild(tr);
  });
}
function fillBitac(){
  const tb=$('#tblBitacora tbody'); tb.innerHTML='';
  read(STORAGE.BITAC).slice(0,50).forEach(x=>{
    const tr=document.createElement('tr');
    tr.innerHTML=\`<td>\${x.ts}</td><td>\${x.user}</td><td>\${x.lugar}</td><td>\${x.canal}</td><td>\${x.llam||'-'}</td>\`;
    tb.appendChild(tr);
  });
}
function fillAccesos(){
  const tb=$('#tblAccesos tbody'); tb.innerHTML='';
  const blocked=new Set(read(STORAGE.BLOCK));
  read(STORAGE.ACCESS).slice(0,100).forEach(x=>{
    const tr=document.createElement('tr');
    const isB=blocked.has(x.email);
    tr.innerHTML=\`<td>\${x.ts}</td><td>\${x.email}</td><td>\${x.grado}</td><td>\${x.esp}</td>
    <td>\${isB?'BLOQUEADO':'OK'}</td>
    <td><button class="btn btn-danger" data-mail="\${x.email}">\${isB?'Desbloquear':'Bloquear'}</button></td>\`;
    tb.appendChild(tr);
  });
  tb.querySelectorAll('button').forEach(b=>{
    b.onclick=()=>{
      const mail=b.getAttribute('data-mail');
      let arr=read(STORAGE.BLOCK); const set=new Set(arr);
      if(set.has(mail)) set.delete(mail); else set.add(mail);
      write(STORAGE.BLOCK,[...set]); fillAccesos();
    };
  });
}
function fillByDay(){
  const a=loadAlerts(); const box=$('#allByDay'); const days={};
  a.forEach(x=>{ const d=x.ts.slice(0,10); (days[d]=days[d]||[]).push(x); });
  box.innerHTML=''; Object.entries(days).forEach(([d,list])=>{
    const div=document.createElement('div'); div.style.marginBottom='8px';
    div.innerHTML=\`<b>\${d}</b> — \${list.length} alertas\`; box.appendChild(div);
  });
}

/* Exportar PDF con logo */
$('#btnExportPdf').onclick=async()=>{
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF('p','pt','a4');
  try {
    const resp=await fetch('assets/logo.png'); const blob=await resp.blob();
    const reader=new FileReader();
    reader.onload=()=>{
      const img=reader.result;
      doc.addImage(img,'PNG',40,28,46,46);
      buildPdf(doc);
    };
    reader.readAsDataURL(blob);
  } catch(e){ buildPdf(doc); }
};
function buildPdf(doc){
  doc.setFontSize(15); doc.text('CIE-297 – Reporte de Alertas', 100, 48);
  doc.setFontSize(10); doc.text('Generado: '+nowStr(), 100, 64);
  const head=['ID','Fecha y hora','Nivel','Título','Agente'];
  let y=100;
  doc.setFont(undefined,'bold');
  head.forEach((t,i)=>doc.text(t, 40+ i*110, y));
  doc.setFont(undefined,'normal'); y+=16;
  loadAlerts().slice(0,80).forEach(r=>{
    const row=[r.id,r.ts,r.nivel,r.titulo,r.agente];
    row.forEach((t,i)=>doc.text(String(t).slice(0,30), 40+ i*110, y));
    y+=16; if(y>760){ doc.addPage(); y=60; }
  });
  doc.save('reporte_alertas.pdf');
}
</script>
</body>
</html>
