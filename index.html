<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CIE-297 | Monitoreo en Tiempo Real</title>
  <link rel="icon" href="assets/logo.png" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root{
      --bg:#0b1424;--card:#101b31;--soft:#12213b;--text:#e5ecff;--muted:#93a4c7;
      --line:rgba(255,255,255,.08);
      --hi:#ef4444;--med:#f59e0b;--lo:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    img{max-width:100%}
    .brand{display:flex;gap:.75rem;align-items:center;padding:.75rem 1rem;background:#0b1424;border-bottom:1px solid var(--line)}
    .brand img{width:34px;height:34px}
    .brand h1{margin:0;font-size:18px;font-weight:800}
    .spacer{flex:1}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;
      padding:.55rem 1rem;border:1px solid var(--line);border-radius:10px;background:var(--soft);color:var(--text);cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px}
    .card h3{margin:0;padding:12px 16px;border-bottom:1px solid var(--line)}
    .card-body{padding:16px}
    .grid{display:grid;gap:16px}
    @media(min-width:1100px){.grid-2{grid-template-columns:1fr 360px}}
    label{display:block;margin:10px 0 6px 2px;color:var(--muted)}
    input,select,textarea{width:100%;background:#0d1830;border:1px solid var(--line);border-radius:10px;padding:.75rem;color:var(--text)}
    textarea{min-height:110px;resize:vertical}
    .hidden{display:none !important}
    /* Mapa y alertas */
    #map{height:340px;border:1px dashed rgba(255,255,255,.15);border-radius:10px}
    .legend{display:flex;gap:10px;margin-top:10px}
    .chip{padding:.2rem .7rem;border-radius:999px;border:1px solid var(--line);font-weight:700;background:#15203a}
    .chip.low{background:#0f2b1e;color:#bbf7d0;border-color:#134e27}
    .chip.med{background:#2b260f;color:#fde68a;border-color:#4e3d13}
    .chip.high{background:#2b0f10;color:#fecaca;border-color:#4e1313}
    /* Alertas scroll derecha */
    .alerts{height:340px;overflow:auto;padding:10px}
    .alert{background:#0f1831;border:1px solid var(--line);border-radius:12px;padding:10px 12px;margin:0 0 10px 0}
    .row{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
    .badge{padding:.2rem .6rem;border:1px solid var(--line);border-radius:999px;font-weight:700}
    .badge.low{background:#0f2b1e;color:#bbf7d0;border-color:#134e27}
    .badge.med{background:#2b260f;color:#fde68a;border-color:#4e3d13}
    .badge.high{background:#2b0f10;color:#fecaca;border-color:#4e1313}
    .muted{color:var(--muted);font-size:12px}
    /* Modal login */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.55)}
    .dialog{width:min(480px,92vw);background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px}
    .dialog h3{margin:0 0 8px 0}
  </style>
</head>
<body>
  <header class="brand">
    <img src="assets/logo.png" alt="Escudo">
    <h1>CIE-297 | Monitoreo en Tiempo Real</h1>
    <div class="spacer"></div>
    <button id="btnLogout" class="btn hidden">Cerrar sesión</button>
  </header>

  <main class="container">

    <!-- Acceso -->
    <section id="secAccess" class="grid" style="grid-template-columns: 1fr">
      <div class="card">
        <h3>Registro</h3>
        <div class="card-body grid" style="grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <label for="grado">Grado</label>
            <select id="grado">
              <option>MY</option><option>TCNL</option><option>CNL</option><option>GRAL</option>
              <option>CPT</option><option>SBTTE</option><option>SGTO</option><option>CBO</option>
            </select>
          </div>
          <div>
            <label for="esp">Especialidad</label>
            <input id="esp" placeholder="Especialidad"/>
          </div>
          <div>
            <label for="nom">Nombres</label>
            <input id="nom" placeholder="Nombres"/>
          </div>
          <div>
            <label for="ape">Apellidos</label>
            <input id="ape" placeholder="Apellidos"/>
          </div>
          <div>
            <label for="emailReg">Email</label>
            <input id="emailReg" type="email" placeholder="correo@dominio.mil"/>
          </div>
          <div>
            <label for="passReg">Contraseña</label>
            <input id="passReg" type="password" placeholder="••••••"/>
          </div>
          <div>
            <button class="btn" id="btnCrear">Crear cuenta</button>
          </div>
          <div class="spacer"></div>
          <div style="grid-column:1/-1">
            <button id="btnShowLogin" class="btn">Iniciar sesión</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal de login (oculto) -->
    <section id="loginModal" class="modal hidden">
      <div class="dialog">
        <h3>Iniciar sesión</h3>
        <label for="emailLog">Email</label>
        <input id="emailLog" placeholder="usuario@cie297.mil" />
        <label for="passLog">Contraseña</label>
        <input id="passLog" type="password" placeholder="••••••" />
        <div style="display:flex;gap:10px;margin-top:12px">
          <button id="btnLogin" class="btn">Entrar</button>
          <button id="btnCloseLogin" class="btn" style="background:#0e1629">Cerrar</button>
        </div>
      </div>
    </section>

    <!-- Contenido principal (oculto hasta login) -->
    <section id="secMain" class="grid grid-2 hidden">
      <!-- Columna izquierda: Mapa, Órganos, Misiones -->
      <div class="grid">
        <div class="card">
          <h3>Área Operativa</h3>
          <div class="card-body">
            <div id="map"></div>
            <div class="legend">
              <span class="chip low">BAJA</span>
              <span class="chip med">MEDIA</span>
              <span class="chip high">ALTA</span>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Órganos de búsqueda</h3>
          <div class="card-body grid" style="grid-template-columns:1fr 1fr;gap:12px">
            <div>
              <label for="selLugar">Código indicativo del lugar</label>
              <select id="selLugar">
                <option>HAWAI</option><option>CUBA</option><option>BEIRUT</option><option>LOMAS</option>
              </select>
            </div>
            <div>
              <label for="selCanal">Código indicativo de canales</label>
              <select id="selCanal">
                <option>BLANCO</option><option>ROJO</option><option>AZUL</option><option>AMARILLO</option>
                <option>VERDE</option><option>ROSADO</option><option>GUINDO</option><option>CARMESI</option>
                <option>NEGRO</option><option>KAKI</option><option>MARRON</option><option>TURQUESA</option>
                <option>CELESTE</option><option>NARANJA</option><option>PURPURA</option><option>GRIS</option>
              </select>
            </div>
            <div style="grid-column:1/-1">
              <label for="selLlamadas">Código indicativo de llamadas</label>
              <select id="selLlamadas">
                <option>ZEUS</option><option>ARIES</option><option>VIRGO</option><option>SAGITARIO</option>
                <option>LIBRA</option><option>CAPRICORNIO</option><option>GEMINIS</option><option>ESCORPIO</option>
                <option>TAURO</option><option>CANCER</option><option>LEO</option><option>PISCIS</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Misiones / Reportes rápidos</h3>
          <div class="card-body grid" style="grid-template-columns:1fr 220px 140px 140px auto;gap:12px">
            <div>
              <label for="tipo">Tipo</label>
              <select id="tipo">
                <option>Operativo en zona</option>
                <option>Rebasado</option>
                <option>Cambio de locación</option>
                <option>Secuestro</option>
                <option>Incautación de autos</option>
                <option>Otros</option>
              </select>
            </div>
            <div>
              <label for="nivel">Nivel</label>
              <select id="nivel">
                <option>BAJA</option><option>MEDIA</option><option>ALTA</option>
              </select>
            </div>
            <div>
              <label for="lat">Lat</label>
              <input id="lat" placeholder="lat"/>
            </div>
            <div>
              <label for="lng">Lng</label>
              <input id="lng" placeholder="lng"/>
            </div>
            <div style="display:flex;align-items:end">
              <button class="btn" id="btnGeo">Usar ubicación</button>
            </div>
            <div style="grid-column:1/-1">
              <label for="msg">Mensaje</label>
              <select id="msg">
                <option>PETA</option><option>LAMBO</option><option>TRICICLO</option><option>PATINETA</option>
                <option>FRUTAS</option><option>MOTOBOMBA</option><option>CUCHARA</option><option>TENEDOR</option>
                <option>CHISGUETE</option><option>PINTURA ROJA</option><option>PINTURA NARANJA</option><option>PINTURA AZUL</option>
                <option>PINTURA VERDE</option><option>PINTURA AMARILLA</option><option>PINTURA CAFE</option>
                <option>YENAS</option><option>LOBOS</option><option>LIEBRES</option><option>JUGANDO</option>
                <option>RIO PILCOMAYO</option><option>LAGUNA ESCOBAR</option><option>MALLASA</option>
                <option>CIELO NUBLADO</option><option>HOTEL RADISSON</option><option>HERRADURA</option>
                <option>FEDERAL</option><option>CAIMAN</option><option>LAGARTOS</option>
              </select>
            </div>
            <div style="grid-column:1/-1">
              <label for="detalle">Descripción</label>
              <textarea id="detalle" placeholder="Detallar lo ocurrido..."></textarea>
            </div>
            <div style="grid-column:1/-1;display:flex;justify-content:end">
              <button id="btnEnviar" class="btn">Enviar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Columna derecha: Alertas -->
      <div class="card">
        <h3>Alertas</h3>
        <div id="panelAlerts" class="alerts"></div>
      </div>
    </section>
  </main>

  <script>
    // Estado simple de login (cliente)
    const secAccess = document.getElementById('secAccess');
    const secMain   = document.getElementById('secMain');
    const btnShowLogin = document.getElementById('btnShowLogin');
    const modal = document.getElementById('loginModal');
    const btnCloseLogin = document.getElementById('btnCloseLogin');
    const btnLogin = document.getElementById('btnLogin');
    const btnLogout= document.getElementById('btnLogout');
    const emailLog = document.getElementById('emailLog');
    const passLog  = document.getElementById('passLog');

    function setLogged(v){
      if(v){
        secAccess.classList.add('hidden');
        secMain.classList.remove('hidden');
        btnLogout.classList.remove('hidden');
        initMap();
        startSimulation();
      }else{
        secMain.classList.add('hidden');
        btnLogout.classList.add('hidden');
        secAccess.classList.remove('hidden');
      }
    }
    btnShowLogin.onclick = ()=> modal.classList.remove('hidden');
    btnCloseLogin.onclick= ()=> modal.classList.add('hidden');
    btnLogin.onclick = ()=>{
      // Validación básica (sin exponer credenciales)
      if(!emailLog.value || !passLog.value){ alert('Completa email y contraseña'); return; }
      modal.classList.add('hidden');
      setLogged(true);
    };
    btnLogout.onclick = ()=>{ setLogged(false); };

    // Registro (solo maqueta)
    document.getElementById('btnCrear').onclick = ()=>{
      alert('Cuenta registrada (maqueta). Ahora pulsa "Iniciar sesión".');
    };

    // Mapa
    let map, marker;
    function initMap(){
      if(map) return;
      map = L.map('map').setView([-16.5,-68.15], 6); // Bolivia
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
        maxZoom: 18, attribution: '&copy; OpenStreetMap'
      }).addTo(map);
    }
    document.getElementById('btnGeo').onclick = ()=>{
      if(!navigator.geolocation) return alert('Geolocalización no disponible');
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude,longitude} = pos.coords;
        document.getElementById('lat').value = latitude.toFixed(6);
        document.getElementById('lng').value = longitude.toFixed(6);
        if(map){
          if(marker) marker.remove();
          marker = L.marker([latitude,longitude]).addTo(map);
          map.setView([latitude,longitude], 12);
        }
      },()=>alert('No se pudo obtener ubicación'));
    };

    // Envío de reporte (solo agrega al panel de alertas como demo)
    document.getElementById('btnEnviar').onclick = ()=>{
      const nivel = document.getElementById('nivel').value;
      const tipo  = document.getElementById('tipo').value;
      const msg   = document.getElementById('msg').value;
      const lat   = document.getElementById('lat').value || '-16.5';
      const lng   = document.getElementById('lng').value || '-68.15';
      const who   = document.getElementById('selLlamadas').value;
      addAlert({nivel,titulo:tipo, usuario:who, desc:msg, lat, lng});
      alert('Reporte enviado');
    };

    // Panel de alertas con simulación
    const panel = document.getElementById('panelAlerts');
    const calls = ['ZEUS','ARIES','VIRGO','SAGITARIO','LIBRA','CAPRICORNIO','GEMINIS','ESCORPIO','TAURO','CANCER','LEO','PISCIS'];
    const titles = ['Interferencia RF','Movimiento anómalo','Geocerca violada','Pérdida de comunicación','Operativo iniciado','Actualización de posición','Incidente'];
    function addAlert(a){
      const wrap = document.createElement('div');
      wrap.className = 'alert';
      const badgeClass = a.nivel==='ALTA'?'high':(a.nivel==='MEDIA'?'med':'low');
      const time = new Date().toLocaleTimeString('es-BO',{hour12:false});
      wrap.innerHTML = `
        <div class="row">
          <strong>${a.usuario}</strong>
          <span class="badge ${badgeClass}">${a.nivel}</span>
          <span class="muted">${time}</span>
        </div>
        <div style="margin-top:6px">${a.titulo} — <span class="muted">${a.desc}</span></div>
        <div class="muted" style="margin-top:4px">(${Number(a.lat).toFixed(4)}, ${Number(a.lng).toFixed(4)})</div>
      `;
      panel.prepend(wrap);
    }
    let simTimer;
    function startSimulation(){
      if(simTimer) return;
      simTimer = setInterval(()=>{
        const nivel = ['BAJA','MEDIA','ALTA'][Math.floor(Math.random()*3)];
        const titulo= titles[Math.floor(Math.random()*titles.length)];
        const usuario=calls[Math.floor(Math.random()*calls.length)];
        const lat=(-14 - Math.random()*4).toFixed(4);
        const lng=(-66 - Math.random()*4).toFixed(4);
        addAlert({nivel,titulo,usuario,desc:'SIMULADO',lat,lng});
      },5000);
    }
  </script>
</body>
</html>
